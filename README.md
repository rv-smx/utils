# SMX Related Utilities

This repository contains many useful utilities for the RISC-V stream-based memory access extension.

## Usage of Utilities

### [smx_analysis.py](smx_analysis.py)

Run SMX analysis on projects/repositories, such as SPEC CPU, by the given compilation configurations.

Example:

```
mkdir spec06
./smx_analysis.py /path/to/spec06/src \
  -c config.spec06.json \
  -l /path/to/smx-transforms/src/libSMXTransforms.so \
  -o spec06
```

Then analysis results will be stored in `spec06/benchmark_name.json`.

### [result_analysis.py](result_analysis.py)

Analyse the analysis results collected by `smx_analysis.py`.

Example:

```
./result_analysis.py spec06
```

### [libprof](libprof.c) and [prof_reader.py](prof_reader.py)

* `libprof`: profiling library for the loop profiler, which can profile the D-cache read/write MPKI for all loops in a program.
* `prof_reader.py`: parse and print the profiling data generated by `libprof`.

Example:

For the following C program `sort.c`:

```c
#include <stdio.h>
#include <stdlib.h>

extern void __loop_profile_func_enter();
extern void __loop_profile_func_exit();

int main() {
  int len;
  scanf("%d", &len);
  int *arr = malloc(len * sizeof(int));
  for (int i = 0; i < len; ++i) scanf("%d", &arr[i]);

  __loop_profile_func_enter();
  for (int i = 0; i < len - 1; ++i) {
    __loop_profile_func_enter();
    for (int j = i + 1; j < len; ++j) {
      if (arr[j] < arr[i]) {
        int t = arr[j];
        arr[j] = arr[i];
        arr[i] = t;
      }
    }
    __loop_profile_func_exit();
  }
  __loop_profile_func_exit();

  for (int i = 0; i < len; ++i) printf("%d ", arr[i]);
  printf("\n");
  return 0;
}
```

Compile with `libprof`:

```
gcc -O3 libprof.c -c -o libprof.o `pkg-config --cflags glib-2.0`
gcc -g -O3 sort.c libprof.o -o sort `pkg-config --libs glib-2.0`
```

After running the program, the profile `sort.prof` will be generated, read it by running:

```
./prof_reader.py sort sort.prof
```

## License

[GPL-v3](LICENSE).
